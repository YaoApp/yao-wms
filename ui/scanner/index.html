<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>扫码</title>
    <script src="./yao.js"></script>
    <script src="./jquery.js"></script>
  </head>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji",
        "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
      color: #a2a5b9;
    }
  </style>
  <link rel="stylesheet" href="./css/add.css" />

  <body style="margin: 0; background-color: #3b3b41">
    <div id="body">
      <div class="bar_0">
        <svg
          viewBox="64 64 896 896"
          focusable="false"
          data-icon="menu-unfold"
          width="1em"
          height="1em"
          fill="currentColor"
          aria-hidden="true"
        >
          <path
            d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM142.4 642.1L298.7 519a8.84 8.84 0 000-13.9L142.4 381.9c-5.8-4.6-14.4-.5-14.4 6.9v246.3a8.9 8.9 0 0014.4 7z"
          ></path>
        </svg>
        <span class="title">扫码</span>
      </div>

      <div class="bar_1">
        <span>扫码 / 添加单品</span>
      </div>

      <div class="bar_2">
        <span class="bar_2_title">添加</span>
        <div class="bar_1_div3">
          <button id="save_all">保存所有</button>
        </div>
      </div>
      <div class="bar_3">
        <div class="bar_3_top">
          <div class="bar_1_div">
            <span>编码：</span>
            <input
              id="inp_code"
              name="sn"
              class="inp_1"
              placeholder="输入编码"
            />
          </div>

          <div class="bar_1_div2">
            <span>状态：</span>
            <select class="bar_1_select" id="select_status">
              <option class="opt" value="进入">进入</option>
              <option class="opt" value="离开">离开</option>
            </select>
          </div>

          <div class="bar_1_div2">
            <span>人员：</span>
            <select
              name="user_id"
              class="bar_1_select bar_2_select"
              id="user_select"
            >
              <option value="正常">测试1</option>
              <option value="不足">测试2</option>
            </select>
          </div>
          <div class="bar_1_div2">
            <div class="bar_1_div4">
              <!-- <button onclick="Adds()">新增一条</button> -->
            </div>
          </div>
        </div>

        <!--商品渲染开始-->
        <div id="total_product" class="bar_3_div6">
          <!-- <div class="bar_3_div5">
          <img src="./img/jaiodai.jpg" width="100%" height="180px" />
          <p class="bar_3_div6_p">标签: <span>10000001</span></p>

          <p class="bar_3_div6_p">单位: <span>个</span></p>

          <p class="bar_3_div6_p">物资名称: <span>梯子</span></p>

          <p class="bar_3_div6_p">规格型号: <span>高度: 450</span></p>
        </div>
        <div class="bar_3_div5">
          <img src="./img/jaiodai.jpg" width="100%" height="180px" />
          <p class="bar_3_div6_p">标签: <span>10000001</span></p>

          <p class="bar_3_div6_p">单位: <span>个</span></p>

          <p class="bar_3_div6_p">物资名称: <span>梯子</span></p>

          <p class="bar_3_div6_p">规格型号: <span>高度: 450</span></p>
        </div>
        <div class="bar_3_div5">
          <img src="./img/jaiodai.jpg" width="100%" height="180px" />
          <p class="bar_3_div6_p">标签: <span>10000001</span></p>

          <p class="bar_3_div6_p">单位: <span>个</span></p>

          <p class="bar_3_div6_p">物资名称: <span>梯子</span></p>

          <p class="bar_3_div6_p">规格型号: <span>高度: 450</span></p>
        </div>
        <div class="bar_3_div5">
          <img src="./img/jaiodai.jpg" width="100%" height="180px" />
          <p class="bar_3_div6_p">标签: <span>10000001</span></p>

          <p class="bar_3_div6_p">单位: <span>个</span></p>

          <p class="bar_3_div6_p">物资名称: <span>梯子</span></p>

          <p class="bar_3_div6_p">规格型号: <span>高度: 450</span></p>
        </div>
        <div class="bar_3_div5">
          <img src="./img/jaiodai.jpg" width="100%" height="180px" />
          <p class="bar_3_div6_p">标签: <span>10000001</span></p>

          <p class="bar_3_div6_p">单位: <span>个</span></p>

          <p class="bar_3_div6_p">物资名称: <span>梯子</span></p>

          <p class="bar_3_div6_p">规格型号: <span>高度: 450</span></p>
        </div>
        <div class="bar_3_div5">
          <img src="./img/jaiodai.jpg" width="100%" height="180px" />
          <p class="bar_3_div6_p">标签: <span>10000001</span></p>

          <p class="bar_3_div6_p">单位: <span>个</span></p>

          <p class="bar_3_div6_p">物资名称: <span>梯子</span></p>

          <p class="bar_3_div6_p">规格型号: <span>高度: 450</span></p>
        </div>
        <div class="bar_3_div5">
          <img src="./img/jaiodai.jpg" width="100%" height="180px" />
          <p class="bar_3_div6_p">标签: <span>10000001</span></p>

          <p class="bar_3_div6_p">单位: <span>个</span></p>

          <p class="bar_3_div6_p">物资名称: <span>梯子</span></p>

          <p class="bar_3_div6_p">规格型号: <span>高度: 450</span></p>
        </div> -->
        </div>
      </div>
    </div>
    <!--弹窗开始-->
    <div id="web_alert" class="web_notice">
      <div class="web_notice_div1">
        <h3 class="web_notice_h3">操作成功!</h3>
        <a class="web_notice_a" onclick="confirmAlert()">确认</a>
      </div>
    </div>

    <!--弹窗结束-->
  </body>
  <script>
    const yao = new Yao();
    function print(data) {
      document.querySelector("#output").value = JSON.stringify(data);
    }

    $(document).ready(function () {
      var resp = GetUser();
    });
    // 获取用户下拉接口
    async function GetUser() {
      var resp = await yao.Get("/user/all");
      var ops = ""; //` <option selected = "selected" disabled="disabled" >请选择</option>`;
      for (var i in resp) {
        ops = ops + ` <option value=${resp[i].id}>${resp[i].name}</option>`;
      }
      //console.log(ops);
      $("#user_select").html(ops);
      return resp;
    }

    const temp_arr = [];
    async function GetSku(code) {
      var resp = await yao.Get("/product/find?code=" + code);
      if (resp.id) {
        var params = {};
        params.status = $("#select_status").val();
        params.code = $("#inp_code").val();
        params.user_id = $("#user_select").val();
        resp.params = params;

        temp_arr.push(resp);
        var numbers = temp_arr.length;

        var all = $("#total_product").html();
        // <img src="${resp.material.icon[0]}" width="100%" height="180px" />

        if (numbers % 4 == 1) {
          all =
            all +
            ` <div class="bar_3_div5 bar_3_div5_first">
            <img src="${resp.material.icon}"  />
          <p class="bar_3_div6_p">标签: <span>${resp.sku_sn}</span></a>删除</a></p>

          <p class="bar_3_div6_p">单位: <span>${resp.unit}</span></p>

          <p class="bar_3_div6_p">物资名称: <span>${resp.material.name}</span></p>

          <p class="bar_3_div6_p">规格型号: <span>高度：${resp.specs["高度"]}</span></p>
          
        </div>
        `;
        } else {
          all =
            all +
            ` <div class="bar_3_div5">
            <img src="${resp.material.icon}"  />
          <p class="bar_3_div6_p">标签: <span>${resp.sku_sn}</span></p>

          <p class="bar_3_div6_p">单位: <span>${resp.unit}</span></p>

          <p class="bar_3_div6_p">物资名称: <span>${resp.material.name}</span></p>

          <p class="bar_3_div6_p">规格型号: <span>高度：${resp.specs["高度"]}</span></p>
        </div>
        `;
        }

        $("#total_product").html(all);
        console.log(temp_arr);
      }

      return resp;
    }
    $(document).keydown(function (event) {
      if (event.keyCode == 13) {
        var code = $("#inp_code").val();
        var data = GetSku(code);
        //console.log(data);
      }
    });

    // 点击回车然后去请求查询单品的接口
    // $("#inp_code").keyup(function () {
    //   if (event.keyCode == 13) {
    //   }
    // });

    $("#save_all").click(function () {
      var params = {};
      params.status = $("#select_status").val();
      params.code = $("#inp_code").val();
      params.user_id = $("#user_select").val();
      params.data = temp_arr;
      console.log(params);
      PostALL(params);
    });
    function confirmAlert() {
      document.querySelector(".web_notice").remove();
      location.reload(true);
    }

    async function PostALL(data) {
      const resp = await yao.Post("/product/save", { data: data });
      if (resp.code == 200) {
        $("#web_alert").css("display", "block");
        $("#body").css("filter", "blur(20px)");
      } else {
        $(".web_notice_h3").html("操作失败!");
        $("#web_alert").css("display", "block");
        $("#body").css("filter", "blur(20px)");
      }
    }
  </script>
</html>
